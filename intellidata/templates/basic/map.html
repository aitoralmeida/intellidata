{% set link="local" %}
{% set title="Local map" %}
{% extends "master.html" %}
{% block body %}
        
    {% from "_widgets.html" import map, timeline %}

    <div class="container text-center">
        <div class="page-header">
            <h1>Information for zipcode {{ zipcode }}</h1>
            <p>This section includes detailed information of {{ zipcode }}</p>
        </div>

        <div class="row">
            <div class="col-lg-3">
                <table class="table table-border table-hover">
                    <thead>
                        <tr>
                            <th class="text-center">#</th>
                            <th class="text-center">Value</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><b>Incomes: </b></td>
                            <td>{{ summary['incomes.total'] }}</td>
                        </tr>
                        <tr>
                            <td><b>Payments: </b></td>
                            <td>{{ summary['numpay.total'] }}</td>
                        </tr>
                        <tr>
                            <td><b>Cards: </b></td>
                            <td>{{ summary['numcards.total'] }}</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <div class="col-lg-3">
                 <table class="table table-border table-hover">
                    <thead>
                        <tr>
                            <th class="text-center">#</th>
                            <th class="text-center">Top zipcodes</th>
                            <th class="text-center">Incomes</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for pos, (zipcode, value) in summary['top_incomes'] %}
                        <tr>
                            <td><b>{{ pos + 1 }}</b></td>
                            <td><a href="{{ url_for('.zipcode_summary', zipcode = zipcode) }}">{{ zipcode }}</a></td>
                            <td>{{ value }} €</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>               
                <a class="btn btn-primary" href="{{ request.path }}?top={{ summary['top_pays']|length + 5 }}">More</a>
            </div>
            <div class="col-lg-3">
                 <table class="table table-border table-hover">
                    <thead>
                        <tr>
                            <th class="text-center">#</th>
                            <th class="text-center">Top zipcodes</th>
                            <th class="text-center">Payments</th>
                        </tr>
                    </thead>
                    <tbody>
                        {%  for pos, (zipcode, value) in summary['top_pays'] %}
                        <tr>
                            <td><b>{{ pos + 1 }}</b></td>
                            <td><a href="{{ url_for('.zipcode_summary', zipcode = zipcode) }}">{{ zipcode }}</a></td>
                            <td>{{ value }} payments</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
                <a class="btn btn-primary" href="{{ request.path }}?top={{ summary['top_pays']|length + 5 }}">More</a>
            </div>
            <div class="col-lg-3">
                 <table class="table table-border table-hover">
                    <thead>
                        <tr>
                            <th class="text-center">#</th>
                            <th class="text-center">Top zipcodes</th>
                            <th class="text-center">Average</th>
                        </tr>
                    </thead>
                    <tbody>
                        {%  for pos, (zipcode, value) in summary['top_avg'] %}
                        <tr>
                            <td><b>{{ pos + 1 }}</b></td>
                            <td><a href="{{ url_for('.zipcode_summary', zipcode = zipcode) }}">{{ zipcode }}</a></td>
                            <td>{{ '%.2f' % value }} €</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table> 
                <a class="btn btn-primary" href="{{ request.path }}?top={{ summary['top_pays']|length + 5 }}">More</a>
            </div>
        </div>

        <div class="row">
            <div class="col-lg-6">
                <div class="page-header">
                    <h2>Heat map</h2>
                </div>
                {{ map("0", file_link_path, link_template, file_link_path, zipcode, algorithm, algorithms, field, fields) }}
            </div>

            <div class="col-lg-5 col-lg-offset-1">
                <div class="page-header">
                    <h2>Demography</h2>
                </div>
                {% if demography %} 
                 <table class="table table-border table-hover">
                    <thead>
                        <tr>
                            <th class="text-center">Age</th>
                            <th class="text-center">Male</th>
                            <th class="text-center">Female</th>
                            <th class="text-center">Company</th>
                            <th class="text-center">Total</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for age in ['0', '1', '2', '3', '4', '5', '6' ] %}
                        <tr>
                            <td><b>{{ ages[age]  }}</b></td>
                            <td>{{ '%.2f' % cubes['male'][age] }} %</td>
                            <td>{{ '%.2f' % cubes['female'][age] }} %</td>
                            <td>{{ '%.2f' % cubes['enterprise'].get(age, 0) }} %</td>
                            <td>{{ '%.2f' % cubes_totals[age] }} %</td>
                        </tr>
                        {% endfor %}
                        <tr>
                            <td><b>Total</b></td>
                            <td>{{ '%.2f' % cubes_totals['male'] }} %</td>
                            <td>{{ '%.2f' % cubes_totals['female'] }} %</td>
                            <td>{{ '%.2f' % cubes_totals['enterprise'] }} %</td>
                            <td>{{ '%.2f' % 100}} %</td>
                        </tr>
                    </tbody>
                </table>
                {% else %}
                <div class="alert alert-danger">
                    <h1>Demographic data not found</h1>
                    <p>There is no demographic data for this particular zipcode in this particular period of time.</p>
                </div>
                {% endif %}
            </div>
        </div>

        <div class="page-header">
            <h2>Distribution</h2>
        </div>
        <p>Expenditure by zipcode, sorted by amount.</p>
        {{ timeline(summary['timeline_headers'], summary['timeline_values'], 'summary') }}

        <div class="page-header">
            <h2>Navigate</h2>
        </div>

        <div>Months: 
        <a class="btn btn-primary" href="{{ url_for('.zipcode_map_algorithm', zipcode = zipcode, algorithm = algorithm, field = field) }}">Total</a>
        {% for cur_month in months %}
            <a class="btn {% if month == cur_month %}btn-default{%else%}btn-primary{% endif %}" href="{{ url_for('.zipcode_map_algorithm_month', zipcode = zipcode, algorithm = algorithm, field = field, month = cur_month) }}">{{ months[cur_month] }}</a>
        {% endfor %}
        </div>
        <div>Weeks:
        <a class="btn btn-primary" href="{{ url_for('.zipcode_map_algorithm', zipcode = zipcode, algorithm = algorithm, field = field) }}">Total</a>
        {% for cur_week in weeks %}
            <a class="btn {% if week == cur_week %}btn-default{%else%}btn-primary{% endif %}" href="{{ url_for('.zipcode_map_algorithm_week', zipcode = zipcode, algorithm = algorithm, field = field, week = cur_week) }}">{{ weeks[cur_week].date() }}</a>
        {% endfor %}
        </div>
    </div>

{% endblock %}
{% block scripts %}

    {% from "_widgets.html" import map_scripts, map_initializer, timeline_scripts, timeline_load %}

    {{ map_scripts() }}
    {{ timeline_scripts(skip_raphael = True) }}


    {{ map_initializer("0", file_link_path, fields) }}
    {{ timeline_load("summary") }}

{% endblock %}
